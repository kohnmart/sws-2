<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>canvas-overview</title>
  </head>
  <body>
    <h1>Canvas Overview</h1>
    <div>
      <ul id="canvas-list"></ul>
    </div>
    <div>
      <form id="canvas-form">
        <label for="name">Name:</label>
        <input name="name" type="text" />
        <input type="submit" />
      </form>
    </div>
  </body>
</html>
<script>
  // Fetch the canvas list from the server
  fetch('api/all-canvas')
    .then((response) => response.json())
    .then((data) => {
      if (data.status === 200) {
        const canvasList = data.list;

        // Loop through the canvasList and create list items
        const listItems = canvasList.map((canvas) => {
          const listItem = document.createElement('li');
          listItem.textContent = `Canvas ID: ${canvas.canvas_id}, Host ID: ${canvas.host_id}, Name: ${canvas.name}`;
          return listItem;
        });

        // Append the list items to the canvasListElement
        listItems.forEach((listItem) => {
          canvasListElement.appendChild(listItem);
        });
      } else {
        // Handle the error case
        console.error(data.message);
      }
    })
    .catch((error) => {
      console.error('An error occurred:', error);
    });

  const createNewCanvas = async (event) => {
    event.preventDefault(); // Prevent the form from submitting normally

    const formData = new FormData(canvasForm);
    formData.append('host_id', hostId || ''); // Append host_id to form data

    const obj = {
      name: formData.get('name'),
      hostId: formData.get('host_id'),
    };

    const response = await fetch('api/create', {
      method: 'POST',
      headers: {
        Accept: 'application/json',
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(obj), // Send JSON data in the request body
    });

    if (response.ok) {
      // Handle success
      console.log('Form submitted successfully teter');
      // Refresh the page or perform other actions
    } else {
      // Handle error
      console.error('Form submission failed');
    }
  };

  // Attach the event listener to the form
  const canvasForm = document.getElementById('canvas-form');
  const hostId = localStorage.getItem('host_id');
  canvasForm.addEventListener('submit', createNewCanvas);
</script>
